{"ast":null,"code":"import _slicedToArray from\"C:/Users/Sinem Morzambak/Desktop/my-OBSS-proejct/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectSpread from\"C:/Users/Sinem Morzambak/Desktop/my-OBSS-proejct/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{createContext,useContext,useEffect,useReducer}from'react';import useFetch from'../hooks/useFetch';import useStorage from'../hooks/useStorage';import{jsx as _jsx}from\"react/jsx-runtime\";var initialState={isLoading:false,isLoggedIn:null,currentUser:null};var reducer=function reducer(state,action){switch(action.type){case'LOADING':return _objectSpread(_objectSpread({},state),{},{isLoading:true});case'SET_AUTHORIZED':return _objectSpread(_objectSpread({},state),{},{isLoggedIn:true,isLoading:false,currentUser:action.payload});case'SET_UNAUTHORIZED':return _objectSpread(_objectSpread({},state),{},{isLoggedIn:false});case'LOGOUT':return _objectSpread(_objectSpread({},initialState),{},{isLoggedIn:false});default:return{state:state};}};var newState=reducer(initialState,{type:'LOGOUT'});var CurrentUserContext=/*#__PURE__*/createContext([{},function(){}]);var CurrentUserProvider=function CurrentUserProvider(_ref){var children=_ref.children;var value=useReducer(reducer,initialState);return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:value,children:children});};var CurrentUserChecker=function CurrentUserChecker(_ref2){var children=_ref2.children;var _useFetch=useFetch('/user'),_useFetch2=_slicedToArray(_useFetch,2),response=_useFetch2[0].response,doFetch=_useFetch2[1];var _useContext=useContext(CurrentUserContext),_useContext2=_slicedToArray(_useContext,2),dispatch=_useContext2[1];var _useStorage=useStorage('token'),_useStorage2=_slicedToArray(_useStorage,1),token=_useStorage2[0];useEffect(function(){if(!token){dispatch({type:'SET_UNAUTHORIZED'});return;}doFetch();dispatch({type:'LOADING'});},[token,doFetch,dispatch]);useEffect(function(){if(!response){return;}dispatch({type:'SET_AUTHORIZED',payload:response.user});},[dispatch,response]);return children;};export{CurrentUserContext,CurrentUserProvider,CurrentUserChecker};","map":{"version":3,"names":["createContext","useContext","useEffect","useReducer","useFetch","useStorage","initialState","isLoading","isLoggedIn","currentUser","reducer","state","action","type","payload","newState","CurrentUserContext","CurrentUserProvider","children","value","CurrentUserChecker","response","doFetch","dispatch","token","user"],"sources":["C:/Users/Sinem Morzambak/Desktop/my-OBSS-proejct/src/context/currentUser.jsx"],"sourcesContent":["import { createContext, useContext, useEffect, useReducer } from 'react'\r\nimport useFetch from '../hooks/useFetch'\r\nimport useStorage from '../hooks/useStorage'\r\n\r\nconst initialState = {\r\n\tisLoading: false,\r\n\tisLoggedIn: null,\r\n\tcurrentUser: null,\r\n}\r\n\r\nconst reducer = (state, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase 'LOADING':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tisLoading: true,\r\n\t\t\t}\r\n\t\tcase 'SET_AUTHORIZED':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tisLoggedIn: true,\r\n\t\t\t\tisLoading: false,\r\n\t\t\t\tcurrentUser: action.payload,\r\n\t\t\t}\r\n\t\tcase 'SET_UNAUTHORIZED':\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tisLoggedIn: false,\r\n\t\t\t}\r\n\t\tcase 'LOGOUT':\r\n\t\t\treturn {\r\n\t\t\t\t...initialState,\r\n\t\t\t\tisLoggedIn: false\r\n\t\t\t}\r\n\t\tdefault:\r\n\t\t\treturn {\r\n\t\t\t\tstate,\r\n\t\t\t}\r\n\t}\r\n}\r\n\r\nconst newState = reducer(initialState, { type: 'LOGOUT' })\r\n\r\nconst CurrentUserContext = createContext([{}, () => {\r\n}])\r\n\r\nconst CurrentUserProvider = ({ children }) => {\r\n\tconst value = useReducer(reducer, initialState)\r\n\treturn <CurrentUserContext.Provider value={value}>{children}</CurrentUserContext.Provider>\r\n}\r\n\r\nconst CurrentUserChecker = ({ children }) => {\r\n\tconst [{ response }, doFetch] = useFetch('/user')\r\n\tconst [, dispatch] = useContext(CurrentUserContext)\r\n\tconst [token] = useStorage('token')\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!token) {\r\n\t\t\tdispatch({ type: 'SET_UNAUTHORIZED' })\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tdoFetch()\r\n\t\tdispatch({ type: 'LOADING' })\r\n\t}, [token, doFetch, dispatch])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!response) {\r\n\t\t\treturn\r\n\t\t}\r\n\t\tdispatch({ type: 'SET_AUTHORIZED', payload: response.user })\r\n\t}, [dispatch, response])\r\n\r\n\treturn children\r\n}\r\n\r\nexport { CurrentUserContext, CurrentUserProvider, CurrentUserChecker }\r\n"],"mappings":"2QAAA,OAASA,aAAT,CAAwBC,UAAxB,CAAoCC,SAApC,CAA+CC,UAA/C,KAAiE,OAAjE,CACA,MAAOC,SAAP,KAAqB,mBAArB,CACA,MAAOC,WAAP,KAAuB,qBAAvB,C,2CAEA,GAAMC,aAAY,CAAG,CACpBC,SAAS,CAAE,KADS,CAEpBC,UAAU,CAAE,IAFQ,CAGpBC,WAAW,CAAE,IAHO,CAArB,CAMA,GAAMC,QAAO,CAAG,QAAVA,QAAU,CAACC,KAAD,CAAQC,MAAR,CAAmB,CAClC,OAAQA,MAAM,CAACC,IAAf,EACC,IAAK,SAAL,CACC,sCACIF,KADJ,MAECJ,SAAS,CAAE,IAFZ,GAID,IAAK,gBAAL,CACC,sCACII,KADJ,MAECH,UAAU,CAAE,IAFb,CAGCD,SAAS,CAAE,KAHZ,CAICE,WAAW,CAAEG,MAAM,CAACE,OAJrB,GAMD,IAAK,kBAAL,CACC,sCACIH,KADJ,MAECH,UAAU,CAAE,KAFb,GAID,IAAK,QAAL,CACC,sCACIF,YADJ,MAECE,UAAU,CAAE,KAFb,GAID,QACC,MAAO,CACNG,KAAK,CAALA,KADM,CAAP,CAxBF,CA4BA,CA7BD,CA+BA,GAAMI,SAAQ,CAAGL,OAAO,CAACJ,YAAD,CAAe,CAAEO,IAAI,CAAE,QAAR,CAAf,CAAxB,CAEA,GAAMG,mBAAkB,cAAGhB,aAAa,CAAC,CAAC,EAAD,CAAK,UAAM,CACnD,CADwC,CAAD,CAAxC,CAGA,GAAMiB,oBAAmB,CAAG,QAAtBA,oBAAsB,MAAkB,IAAfC,SAAe,MAAfA,QAAe,CAC7C,GAAMC,MAAK,CAAGhB,UAAU,CAACO,OAAD,CAAUJ,YAAV,CAAxB,CACA,mBAAO,KAAC,kBAAD,CAAoB,QAApB,EAA6B,KAAK,CAAEa,KAApC,UAA4CD,QAA5C,EAAP,CACA,CAHD,CAKA,GAAME,mBAAkB,CAAG,QAArBA,mBAAqB,OAAkB,IAAfF,SAAe,OAAfA,QAAe,CAC5C,cAAgCd,QAAQ,CAAC,OAAD,CAAxC,wCAASiB,QAAT,eAASA,QAAT,CAAqBC,OAArB,eACA,gBAAqBrB,UAAU,CAACe,kBAAD,CAA/B,4CAASO,QAAT,iBACA,gBAAgBlB,UAAU,CAAC,OAAD,CAA1B,4CAAOmB,KAAP,iBAEAtB,SAAS,CAAC,UAAM,CACf,GAAI,CAACsB,KAAL,CAAY,CACXD,QAAQ,CAAC,CAAEV,IAAI,CAAE,kBAAR,CAAD,CAAR,CACA,OACA,CAEDS,OAAO,GACPC,QAAQ,CAAC,CAAEV,IAAI,CAAE,SAAR,CAAD,CAAR,CACA,CARQ,CAQN,CAACW,KAAD,CAAQF,OAAR,CAAiBC,QAAjB,CARM,CAAT,CAUArB,SAAS,CAAC,UAAM,CACf,GAAI,CAACmB,QAAL,CAAe,CACd,OACA,CACDE,QAAQ,CAAC,CAAEV,IAAI,CAAE,gBAAR,CAA0BC,OAAO,CAAEO,QAAQ,CAACI,IAA5C,CAAD,CAAR,CACA,CALQ,CAKN,CAACF,QAAD,CAAWF,QAAX,CALM,CAAT,CAOA,MAAOH,SAAP,CACA,CAvBD,CAyBA,OAASF,kBAAT,CAA6BC,mBAA7B,CAAkDG,kBAAlD"},"metadata":{},"sourceType":"module"}